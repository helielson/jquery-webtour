/*!
 * Web Tour Plugin 0.1
 * https://github.com/shankarcabus
 * Copyright 2013
 * Free to use under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * @author: shankarcabus@gmail.com
*/
(function(e,t,n,r){function o(t,n){this.element=e(t);this.options=e.extend({},s,n);$body=e("body");this._defaults=s;this._name=i;this.init()}var i="tour",s={text:"Lorem Ipsum",arrowImage:"",arrowOrigin:"T",arrowTarget:"B",arrowPadding:0,textOrigin:"T",textTarget:"BL",textWidth:200,textPadding:0,padding:0,button:{clss:"btn btn-primary",text:"Ok, got it"},callback:function(){},lock:true};o.prototype={init:function(){if(this.element.length<=0){return false}var t=this;var n=$body.data("stepIndex")===r?0:$body.data("stepIndex"),i=e("<div/>").addClass("tour step"+n),s,o,u,a;var f=e("<div/>").html("<p>"+this.options.text+"</p>").width(this.options.textWidth).addClass("tour-text").css("padding",this.options.textPadding);var l=e("<button/>").addClass(t.options.button.clss).html(t.options.button.text).on("click",function(){var r=e(".tour.step"+(n+1));if(r.length>0){r.hide().css("visibility","visible").fadeIn()}else{$body.css({overflow:"initial"})}e(".tour.step"+n).fadeOut();t.options.callback()});f.append(l);var c=e("<img/>").load(function(){var e=t.getCoordinate(t.element,t.options.arrowTarget);var n=t.getPosition(c,t.options.arrowOrigin,e);c.css(n);var r=t.getCoordinate(c,t.options.textTarget);var i=t.getPosition(f,t.options.textOrigin,r);f.css(i)}).attr({src:this.options.arrowImage}).addClass("tour-arrow").css("padding",this.options.arrowPadding);if(this.options.lock){i.append(e("<div/>").css({"z-index":100001,position:"absolute",width:"100%",height:"100%",top:0,left:0}))}i.append(c).append(f);this.makeMask(i);if(n==0){i.css("visibility","visible")}else{i.css("visibility","hidden")}$body.append(i).css({overflow:"hidden"}).data("stepIndex",n+1)},makeMask:function(n){function l(){i.css({top:0,left:f.element.offset().left-a,width:f.element.outerWidth()+a*2,height:f.element.offset().top-a})}function c(){s.css({top:0,right:0,width:$body.outerWidth()-f.element.offset().left-f.element.outerWidth()-a,height:"100%"})}function h(){o.css({bottom:0,left:f.element.offset().left-a,width:f.element.outerWidth()+a*2,height:$body.outerHeight()-f.element.offset().top-f.element.outerHeight()-a})}function p(){u.css({top:0,left:0,width:f.element.offset().left-a,height:"100%"})}function d(){l();p();c();h()}var r=e("<div/>").addClass("mask"),i=r.clone(),s=r.clone(),o=r.clone(),u=r.clone(),a=this.options.padding,f=this;e(t).resize(function(){d()});d();n.append(i).append(s).append(o).append(u)},getCoordinate:function(e,t,n){var r={x:0,y:0},i=e.offset().top,s=i+e.outerHeight()/2,o=i+e.outerHeight(),u=e.offset().left,a=u+e.outerWidth()/2,f=u+e.outerWidth();if(t.indexOf("T")>=0)r.y=i;else if(t.indexOf("B")>=0)r.y=o;else r.y=s;if(t.indexOf("L")>=0)r.x=u;else if(t.indexOf("R")>=0)r.x=f;else r.x=a;return r},getPosition:function(e,t,n){var r={left:0,top:0},i=e.outerWidth(),s=e.outerHeight();if(t.indexOf("T")>=0)r.top=n.y;else if(t.indexOf("B")>=0)r.top=n.y-s;else r.top=n.y-s/2;if(t.indexOf("L")>=0)r.left=n.x;else if(t.indexOf("R")>=0)r.left=n.x-i;else r.left=n.x-i/2;return r}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)